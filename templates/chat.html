{% extends "base.html" %}

{% block title %}Chat — ΔΣ Guardian{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="chat-container">
    <!-- Left Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3>💬 Chat Sessions</h3>
        </div>
        
        <div class="sidebar-content">
            <!-- Current Session -->
            <div class="sidebar-section">
                <h4>Current Session</h4>
                <div class="session-info">
                    <div class="session-name">ΔΣ Guardian Chat</div>
                    <div class="session-status">🟢 Active</div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="sidebar-section">
                <h4>Quick Actions</h4>
                <div class="action-buttons">
                    <button class="action-btn" onclick="clearConversation()">🗑️ Clear Chat</button>
                    <button class="action-btn" onclick="exportChat()">📤 Export</button>
                    <button class="action-btn" onclick="showModelStatus()">🤖 Models</button>
                </div>
            </div>
            
            <!-- System Status -->
            <div class="sidebar-section">
                <h4>System Status</h4>
                <div class="system-status" id="sidebarSystemStatus">
                    <div class="status-item">
                        <span class="status-label">Model:</span>
                        <span class="status-value" id="currentModel">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Status:</span>
                        <span class="status-value" id="systemStatus">🟢 Online</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
        <!-- Messages Container -->
        <div class="chat-messages" id="chatMessages">
            <!-- Loading indicator -->
            <div class="loading-indicator" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p>Loading conversation...</p>
            </div>
            
            <!-- Messages will be inserted here -->
        </div>

        <!-- Chat Input -->
        <div class="chat-input-container">
            <form class="chat-input-form" id="chatForm">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Type your message here..."
                        rows="1"
                        maxlength="10000"
                    ></textarea>
                    
                    <!-- File attachment preview -->
                    <div class="attachment-preview" id="attachmentPreview" style="display: none;">
                        <div class="attachment-item">
                            <span class="attachment-name" id="attachmentName"></span>
                            <button type="button" class="attachment-remove" onclick="removeAttachment()">✕</button>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="chat-send-btn" id="sendBtn">
                    <span class="send-icon">↩️</span>
                </button>
            </form>
            
            <!-- Input Actions -->
            <div class="input-actions">
                <button type="button" class="action-btn-small" onclick="attachFile()">📎 Attach</button>
                <button type="button" class="action-btn-small" onclick="demoReasoning()">🧠 Demo</button>
                <button type="button" class="action-btn-small" onclick="toggleSystemPanel()">⚙️ System</button>
            </div>
            
            <!-- Hidden file input -->
            <input type="file" id="fileInput" style="display: none;" accept="image/*,.txt,.pdf,.doc,.docx,.json,.csv">
        </div>
    </main>

    <!-- Right System Panel -->
    <aside class="system-panel" id="systemPanel">
        <div class="system-panel-header">
            <h3>System Analysis</h3>
            <div class="system-panel-controls">
                <button class="system-panel-btn" onclick="refreshSystemAnalysis()" title="Refresh">🔄</button>
                <button class="system-panel-btn" onclick="forceRefreshSystemAnalysis()" title="Force Refresh">⚡</button>
            </div>
        </div>
        
        <div class="system-panel-content">
            <!-- Current Status -->
            <div class="system-section">
                <h4>Current Status</h4>
                <div class="system-content" id="systemStatusContent">
                    <div class="loading-spinner"></div>
                    <p>Loading system analysis...</p>
                </div>
            </div>
            
            <!-- Tips & Insights -->
            <div class="system-section">
                <h4>Tips & Insights</h4>
                <div class="system-content" id="systemTipsContent">
                    <div class="loading-spinner"></div>
                    <p>Loading tips...</p>
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="system-section">
                <h4>Recent Activity</h4>
                <div class="system-content" id="systemLogsContent">
                    <div class="loading-spinner"></div>
                    <p>Loading logs...</p>
                </div>
            </div>
        </div>
    </aside>
</div>

<!-- System Terminal (Collapsible) -->
<div class="terminal-panel" id="terminalPanel">
    <div class="terminal-header">
        <h3>System Terminal</h3>
        <div class="terminal-controls">
            <button class="terminal-btn" onclick="toggleTerminal()">Toggle</button>
            <button class="terminal-btn" onclick="clearTerminal()">Clear</button>
        </div>
    </div>
    <div class="terminal-content">
        <div class="terminal-window" id="terminalWindow">
            <!-- Terminal output will be inserted here -->
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="{{ url_for('static', path='/js/chat.js') }}"></script>
{% endblock %} 