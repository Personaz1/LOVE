# ü§ñ Automatic Profile Updates - Dr. Harmony

## Overview
Dr. Harmony now automatically understands user emotions and relationship dynamics from natural language and updates profiles accordingly.

## üß† Automatic Detection Features

### 1. **Feelings Detection**
Model automatically detects emotions in both Russian and English:

**Russian Phrases:**
- "—è –ø–ª–æ—Ö–æ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É—é" ‚Üí "Feeling unwell"
- "–≥—Ä—É—Å—Ç–Ω–æ/–≥—Ä—É—Å—Ç–Ω–∞—è/–≥—Ä—É—Å—Ç–Ω—ã–π" ‚Üí "Sad"
- "—Å—á–∞—Å—Ç–ª–∏–≤–∞/—Å—á–∞—Å—Ç–ª–∏–≤/—Å—á–∞—Å—Ç–ª–∏–≤—ã–π" ‚Üí "Happy"
- "—Ä–∞–¥–æ—Å—Ç–Ω–æ/—Ä–∞–¥–æ—Å—Ç–Ω–∞—è/—Ä–∞–¥–æ—Å—Ç–Ω—ã–π" ‚Üí "Joyful"
- "—É—Å—Ç–∞–ª–∞/—É—Å—Ç–∞–ª/—É—Å—Ç–∞–ª—ã–π/—É—Å—Ç–∞–ª–∞—è" ‚Üí "Tired"
- "–∑–ª–∞—è/–∑–ª–æ–π/–∑–ª—é—Å—å" ‚Üí "Angry"
- "–Ω–µ—Ä–≤–Ω–∏—á–∞—é/–≤–æ–ª–Ω—É—é—Å—å/—Ç—Ä–µ–≤–æ–∂–Ω–æ" ‚Üí "Anxious"
- "—Å–ø–æ–∫–æ–π–Ω–æ/—Å–ø–æ–∫–æ–π–Ω–∞—è/—Å–ø–æ–∫–æ–π–Ω—ã–π" ‚Üí "Calm"

**English Phrases:**
- "I feel bad" ‚Üí "Feeling bad"
- "I'm sad" ‚Üí "Sad"
- "I'm happy" ‚Üí "Happy"
- "I'm tired" ‚Üí "Tired"
- "I'm angry" ‚Üí "Angry"
- "I'm nervous" ‚Üí "Nervous"
- "I'm anxious" ‚Üí "Anxious"
- "I'm calm" ‚Üí "Calm"
- "feeling down" ‚Üí "Feeling down"
- "feeling great" ‚Üí "Feeling great"
- "feeling good" ‚Üí "Feeling good"

### 2. **Relationship Status Detection**
Automatically detects relationship dynamics:

**Russian Phrases:**
- "–º—ã —Å—Å–æ—Ä–∏–º—Å—è/–º—ã —Ä—É–≥–∞–µ–º—Å—è/–º—ã –≤ —Å—Å–æ—Ä–µ" ‚Üí "Having conflicts"
- "–≤—Å–µ –ø–ª–æ—Ö–æ" ‚Üí "Relationship difficulties"
- "–≤—Å–µ —Ö–æ—Ä–æ—à–æ/–≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ" ‚Üí "Relationship is good/great"
- "—á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –æ–¥–∏–Ω–æ–∫–æ/–æ–¥–∏–Ω–æ–∫–∏–º/–æ–¥–∏–Ω–æ–∫–æ–π" ‚Üí "Feeling lonely"
- "–º—ã –±–ª–∏–∑–∫–∏" ‚Üí "Feeling close"
- "–º—ã –¥–∞–ª–µ–∫–∏" ‚Üí "Feeling distant"

**English Phrases:**
- "we're fighting/arguing" ‚Üí "Having conflicts"
- "things are bad" ‚Üí "Relationship difficulties"
- "things are good/great" ‚Üí "Relationship is good/great"
- "feeling lonely" ‚Üí "Feeling lonely"
- "feeling close" ‚Üí "Feeling close"
- "feeling distant" ‚Üí "Feeling distant"

### 3. **Automatic Hidden Notes**
Model creates private observations when users mention:

**Topics that trigger hidden notes:**
- Work/Career: "—Ä–∞–±–æ—Ç–∞", "work", "job", "–∫–∞—Ä—å–µ—Ä–∞", "career"
- Family: "—Å–µ–º—å—è", "family", "—Ä–æ–¥–∏—Ç–µ–ª–∏", "parents"
- Social: "–¥—Ä—É–∑—å—è", "friends", "–æ–±—â–µ–Ω–∏–µ", "communication"
- Health: "–∑–¥–æ—Ä–æ–≤—å–µ", "health", "–±–æ–ª–µ–∑–Ω—å", "sick"
- Stress: "—Å—Ç—Ä–µ—Å—Å", "stress", "—É—Å—Ç–∞–ª–æ—Å—Ç—å", "exhaustion"
- Plans: "–ø–ª–∞–Ω—ã", "plans", "—Ü–µ–ª–∏", "goals"
- Dreams: "–º–µ—á—Ç—ã", "dreams", "–∂–µ–ª–∞–Ω–∏—è", "desires"
- Fears: "—Å—Ç—Ä–∞—Ö–∏", "fears", "—Ç—Ä–µ–≤–æ–≥–∏", "anxieties"
- Emotions: "—Ä–∞–¥–æ—Å—Ç—å", "joy", "—Å—á–∞—Å—Ç—å–µ", "happiness", "–≥—Ä—É—Å—Ç—å", "sadness", "–ø–µ—á–∞–ª—å", "grief"

## üîß Technical Implementation

### Updated Files:
1. **`prompts/psychologist_prompt.py`** - Enhanced system prompt with automatic update instructions
2. **`ai_client.py`** - Added automatic detection logic in `_process_response_for_functions()`

### Key Functions:
```python
# Automatic feeling detection
update_current_feeling(username, feeling)

# Automatic relationship status detection  
update_relationship_status(username, status)

# Automatic hidden notes creation
update_hidden_profile(username, hidden_note)

# Profile updates
update_user_profile(username, new_profile)

# Relationship insights
add_relationship_insight(insight)
```

## üéØ User Experience

### Natural Interaction:
- User: "—è –ø–ª–æ—Ö–æ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É—é"
- Model: Responds naturally while automatically updating "current_feeling" to "Feeling unwell"
- No announcement of the update - seamless experience

### Automatic Context Building:
- Model observes patterns and creates hidden notes
- Builds understanding of user over time
- Provides more personalized advice

### Multi-language Support:
- Works in both Russian and English
- Detects emotions regardless of language
- Maintains context across languages

## üìä Example Workflow

1. **User writes:** "–°–µ–≥–æ–¥–Ω—è —è –æ—á–µ–Ω—å —É—Å—Ç–∞–ª–∞ –æ—Ç —Ä–∞–±–æ—Ç—ã"
2. **Model detects:** "—É—Å—Ç–∞–ª–∞" ‚Üí "Tired"
3. **Model updates:** `current_feeling = "Tired"`
4. **Model detects:** "—Ä–∞–±–æ—Ç–∞" ‚Üí Work-related topic
5. **Model creates hidden note:** "User shared about —Ä–∞–±–æ—Ç–∞: –°–µ–≥–æ–¥–Ω—è —è –æ—á–µ–Ω—å —É—Å—Ç–∞–ª–∞ –æ—Ç —Ä–∞–±–æ—Ç—ã... (observed at 2025-01-26 17:45)"
6. **Model responds:** Natural response about being tired from work
7. **Result:** Profile updated automatically, hidden note created, user gets natural response

## üöÄ Benefits

- **Seamless Experience:** No need for explicit commands
- **Natural Language:** Works with everyday conversation
- **Automatic Learning:** Model builds understanding over time
- **Bilingual:** Works in Russian and English
- **Contextual:** Creates relevant hidden notes
- **Personalized:** Better advice based on updated profiles

## üîÆ Future Enhancements

- More emotion detection patterns
- Relationship phase detection
- Communication style analysis
- Conflict pattern recognition
- Growth milestone tracking 